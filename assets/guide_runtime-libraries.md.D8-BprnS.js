import{_ as s,c as i,o as a,ag as t}from"./chunks/framework.Yj-QZn9W.js";const u=JSON.parse('{"title":"Runtime Libraries","description":"","frontmatter":{},"headers":[],"relativePath":"guide/runtime-libraries.md","filePath":"guide/runtime-libraries.md"}'),n={name:"guide/runtime-libraries.md"};function o(r,e,l,d,c,p){return a(),i("div",null,e[0]||(e[0]=[t(`<h1 id="runtime-libraries" tabindex="-1">Runtime Libraries <a class="header-anchor" href="#runtime-libraries" aria-label="Permalink to &quot;Runtime Libraries&quot;">​</a></h1><p>FireSchema generates code that relies on small, dedicated runtime libraries for each target platform. These libraries provide the essential base classes, helper functions, and SDK interaction logic needed for the generated ODM to function correctly. They act as the engine powering the generated code.</p><h2 id="purpose" tabindex="-1">Purpose <a class="header-anchor" href="#purpose" aria-label="Permalink to &quot;Purpose&quot;">​</a></h2><ul><li><strong>Reduce Generated Code Size:</strong> The bulk of the common logic (like query building, data conversion, update handling) resides in the runtime, keeping the generated files focused on type definitions and schema-specific methods.</li><li><strong>Centralize Core Logic:</strong> Allows for improvements, bug fixes, and new features to be implemented in the runtime packages and benefit all users upon updating, without needing to regenerate code (unless the generation templates themselves change).</li><li><strong>Encapsulate SDK Differences:</strong> Provides a mostly consistent API layer over the underlying Firebase Client/Admin SDKs, simplifying the generated code and the developer experience. For example, the <code>getData()</code> method on the query builder works similarly across platforms, even though the underlying SDK calls might differ.</li></ul><h3 id="component-relationships" tabindex="-1">Component Relationships <a class="header-anchor" href="#component-relationships" aria-label="Permalink to &quot;Component Relationships&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph FireSchema_Tool [FireSchema CLI]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        style FireSchema_Tool fill:#f9f,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Generator[Generator (Adapters + Templates)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph User_Project [User Project]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        style User_Project fill:#ccf,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        GeneratedCode[Generated ODM Code&lt;br&gt;(e.g., UsersCollection.ts)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        UserAppCode[User Application Code]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Runtime_Package [Runtime Package]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         style Runtime_Package fill:#cfc,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         RuntimeLib[Runtime Library&lt;br&gt;(e.g., @shtse8/fireschema-ts-client-runtime)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         BaseClasses[Base Classes&lt;br&gt;(e.g., ClientBaseCollectionRef)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         Helpers[Helpers &amp; Converters]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Firebase_SDK [Firebase SDK]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        style Firebase_SDK fill:#ffc,stroke:#333</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SDK[Firebase SDK&lt;br&gt;(e.g., \`firebase\` or \`firebase-admin\`)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Generator -- Generates --&gt; GeneratedCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserAppCode -- Uses --&gt; GeneratedCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GeneratedCode -- Extends/Uses --&gt; BaseClasses;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GeneratedCode -- Imports --&gt; RuntimeLib;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RuntimeLib -- Contains --&gt; BaseClasses;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RuntimeLib -- Contains --&gt; Helpers;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    BaseClasses -- Uses --&gt; SDK;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Helpers -- Uses --&gt; SDK;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserAppCode -- Installs --&gt; RuntimeLib;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserAppCode -- Installs --&gt; SDK;</span></span></code></pre></div><h2 id="available-runtimes" tabindex="-1">Available Runtimes <a class="header-anchor" href="#available-runtimes" aria-label="Permalink to &quot;Available Runtimes&quot;">​</a></h2><p>These are the official runtime packages maintained alongside FireSchema:</p><ul><li><strong><code>@shtse8/fireschema-ts-client-runtime</code></strong> (npm) <ul><li><strong>Target:</strong> <code>typescript-client</code></li><li><strong>SDK Dependency:</strong> <code>firebase</code> (v9+ modular SDK)</li><li><strong>Key Exports:</strong> <code>ClientBaseCollectionRef</code>, <code>ClientBaseQueryBuilder</code>, <code>ClientBaseUpdateBuilder</code>.</li><li><strong>Description:</strong> Provides implementations tailored for the web/client-side Firebase JS SDK.</li></ul></li><li><strong><code>@shtse8/fireschema-ts-admin-runtime</code></strong> (npm) <ul><li><strong>Target:</strong> <code>typescript-admin</code></li><li><strong>SDK Dependency:</strong> <code>firebase-admin</code></li><li><strong>Key Exports:</strong> <code>AdminBaseCollectionRef</code>, <code>AdminBaseQueryBuilder</code>, <code>AdminBaseUpdateBuilder</code>.</li><li><strong>Description:</strong> Provides implementations tailored for the Node.js Firebase Admin SDK.</li></ul></li><li><strong><code>fireschema_dart_runtime</code></strong> (pub.dev) <ul><li><strong>Target:</strong> <code>dart-client</code></li><li><strong>SDK Dependency:</strong> <code>cloud_firestore</code>, <code>meta</code></li><li><strong>Key Exports:</strong> <code>BaseCollectionRef</code>, <code>BaseQueryBuilder</code>, <code>BaseUpdateBuilder</code> (often used as mixins or extended by generated classes).</li><li><strong>Description:</strong> Provides implementations for Dart/Flutter applications using the <code>cloud_firestore</code> plugin.</li></ul></li></ul><h3 id="planned-runtimes" tabindex="-1">Planned Runtimes <a class="header-anchor" href="#planned-runtimes" aria-label="Permalink to &quot;Planned Runtimes&quot;">​</a></h3><ul><li><strong>Dart Admin Runtime (via REST)</strong><ul><li><strong>Target:</strong> <code>dart-admin-rest</code> (tentative name)</li><li><strong>SDK Dependency:</strong> Dart <code>http</code> package (or similar).</li><li><strong>Description:</strong> A planned runtime leveraging the Firestore REST API. This aims to address the long-standing lack of an official Firebase Admin SDK for Dart, enabling powerful server-side Dart applications to interact securely with Firestore using generated type-safe code.</li></ul></li><li><strong>C# Client Runtime</strong><ul><li><strong>Target:</strong> <code>csharp-client</code> (tentative name)</li><li><strong>SDK Dependency:</strong> Firebase SDK for .NET (specifics TBD).</li><li><strong>Description:</strong> Planned support for generating C# code for client applications (e.g., Unity, MAUI, Blazor).</li></ul></li></ul><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><p>As mentioned in the <a href="./installation.html">Installation</a> guide, you <strong>must</strong> install the appropriate <em>available</em> runtime library <strong>in the project where you intend to use the generated code</strong>, alongside the corresponding Firebase SDK. The generated code directly imports from and extends classes/mixins provided by these runtime packages.</p><h2 id="key-components-explained" tabindex="-1">Key Components Explained <a class="header-anchor" href="#key-components-explained" aria-label="Permalink to &quot;Key Components Explained&quot;">​</a></h2><p>While you typically interact with the <em>generated</em> classes (e.g., <code>UsersCollection</code>, <code>UsersQueryBuilder</code>), understanding the role of the underlying runtime base classes can be helpful for advanced usage or debugging.</p><ul><li><strong>Base Collection Reference (<code>ClientBaseCollectionRef</code>, <code>AdminBaseCollectionRef</code>, <code>BaseCollectionRef</code>):</strong><ul><li>Holds the reference to the underlying Firestore <code>CollectionReference</code>.</li><li>Contains the <code>FirestoreDataConverter</code> (<code>converter</code>) responsible for <code>toFirestore</code> (serializing data before writing) and <code>fromFirestore</code> (deserializing data after reading). This handles <code>Timestamp</code> conversions, <code>enum</code> mapping, and applying default values (primarily in Dart&#39;s <code>add</code>).</li><li>Provides core CRUD methods like <code>get(id)</code>, <code>add(data)</code>, <code>set(id, data)</code>, <code>delete(id)</code>.</li><li>Provides the <code>update(id)</code> method which returns an instance of the <code>BaseUpdateBuilder</code>.</li><li>Provides the <code>query()</code> method which returns an instance of the <code>BaseQueryBuilder</code>.</li><li>Provides helper methods like <code>docRef([id])</code> to get the raw underlying <code>DocumentReference</code>.</li><li>Handles the logic for accessing subcollections via generated methods.</li></ul></li><li><strong>Base Query Builder (<code>ClientBaseQueryBuilder</code>, <code>AdminBaseQueryBuilder</code>, <code>BaseQueryBuilder</code>):</strong><ul><li>Holds the underlying Firestore <code>Query</code> object.</li><li>Implements common query methods (<code>where</code>, <code>orderBy</code>, <code>limit</code>, <code>limitToLast</code>, <code>startAt</code>, <code>startAfter</code>, <code>endAt</code>, <code>endBefore</code>). Generated type-safe methods (e.g., <code>whereStatus</code>, <code>whereAge</code>) typically call these base methods with the correct field names.</li><li>Provides methods to execute the query and retrieve results: <ul><li><code>get()</code>: Executes the query and returns the raw <code>QuerySnapshot</code>. Useful for pagination or accessing metadata.</li><li><code>getData()</code>: Executes the query, converts the results using the <code>converter</code>, and returns a typed array/list of data objects (e.g., <code>UserData[]</code> or <code>List&lt;UserData&gt;</code>).</li><li><code>snapshots()</code>: Returns a <code>Stream</code> (Dart) or requires using <code>onSnapshot</code> with <code>query.query</code> (TypeScript) for real-time updates.</li></ul></li><li>Exposes the underlying <code>query</code> object (e.g., <code>query.query</code> in TS, <code>query.query</code> in Dart) for direct use with SDK functions like <code>onSnapshot</code>.</li></ul></li><li><strong>Base Update Builder (<code>ClientBaseUpdateBuilder</code>, <code>AdminBaseUpdateBuilder</code>, <code>BaseUpdateBuilder</code>):</strong><ul><li>Accumulates update operations.</li><li>Provides the internal <code>updateData</code> map where operations are staged.</li><li>Generated methods (<code>setFieldName</code>, <code>incrementFieldName</code>, etc.) add entries to <code>updateData</code>.</li><li>Provides the <code>updateRaw(data)</code> method to merge arbitrary data (like <code>FieldValue</code> operations or nested field updates using dot notation) into the <code>updateData</code>.</li><li>Provides the final <code>commit()</code> method, which takes the accumulated <code>updateData</code> and performs a single Firestore <code>update</code> operation on the target document.</li></ul></li><li><strong>Type Converters/Helpers:</strong><ul><li>Internal utilities used by the base classes.</li><li>Handle serialization/deserialization between your typed objects and Firestore&#39;s data format.</li><li>Manage <code>Timestamp</code> vs. <code>Date</code> conversion (based on TS config).</li><li>Handle <code>enum</code> serialization (e.g., to string) and deserialization.</li><li>Apply <code>defaultValue</code> logic (currently most prominent in Dart&#39;s <code>add</code> implementation).</li></ul></li></ul><p>By separating this core logic into runtime libraries, FireSchema aims for a balance between generated type safety and maintainable, reusable code.</p>`,17)]))}const g=s(n,[["render",o]]);export{u as __pageData,g as default};
